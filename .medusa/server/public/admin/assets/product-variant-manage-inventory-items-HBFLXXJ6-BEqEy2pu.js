import{V as N}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{u as V}from"./chunk-YIZSVS2R--aH1oxDy.js";import{C}from"./chunk-GZBFGV7Y-DohTc1-k.js";import{c as f}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as F}from"./chunk-6HTZNHPT-CDVGSKu-.js";import{R as p,u as w}from"./chunk-4TC5YS65-C5PuDLBH.js";import{a2 as v,ad as E,a4 as g,an as j,ae as S,af as M,aF as P,R,a7 as T,j as e,b as I,a8 as $,a9 as z,y as k,aG as B,t as q,B as x,H as L,w as o,s as A,z as b,x as K,I as H}from"./index-Dtvv6qDr.js";import{X as D}from"./x-mark-mini-DgAd9w61.js";import"./triangles-mini-CBv0rqhu.js";import"./plus-mini-DjY2opRr.js";import"./prompt-BJxEONwP.js";var X=v({inventory:E(v({inventory_item_id:g().min(1,j.t("products.variant.inventory.validation.itemId")),required_quantity:S([M(),g()])}).superRefine((t,n)=>{(t.required_quantity?f(t.required_quantity):0)<1&&n.addIssue({code:P.custom,message:j.t("products.variant.inventory.validation.quantity"),path:["required_quantity"]})}))});function G({form:t,inventoryIndex:n,inventoryItem:l,onRemove:c}){const{t:s}=I(),r=V({queryKey:["inventory_items"],defaultValueKey:"id",defaultValue:l.inventory_item_id,queryFn:d=>A.admin.inventoryItem.list(d),getOptions:d=>d.inventory_items.map(u=>({label:`${u.title} ${u.sku?`(${u.sku})`:""}`,value:u.id}))});return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(b,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.inventory_item_id`,children:s("fields.item")})}),e.jsx(o.Field,{control:t.control,name:`inventory.${n}.inventory_item_id`,render:({field:d})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(C,{...d,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,onBlur:()=>r.onSearchValueChange(""),fetchNextPage:r.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:s("products.create.inventory.itemPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(b,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.required_quantity`,children:s("fields.quantity")})}),e.jsx(o.Field,{control:t.control,name:`inventory.${n}.required_quantity`,render:({field:{onChange:d,value:u,...h}})=>e.jsxs(o.Item,{children:[e.jsx(o.Control,{children:e.jsx(K,{type:"number",className:"bg-ui-bg-field-component",min:0,value:u,onChange:d,...h,placeholder:s("products.create.inventory.quantityPlaceholder")})}),e.jsx(o.ErrorMessage,{})]})})]}),e.jsx(H,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:c,children:e.jsx(D,{})})]},l.id)}function O({variant:t}){const{t:n}=I(),{handleSuccess:l}=w(),c=$({defaultValues:{inventory:t.inventory_items.length?t.inventory_items.map(m=>({required_quantity:m.required_quantity,inventory_item_id:m.inventory.id})):[{inventory_item_id:"",required_quantity:""}]},resolver:z(X)}),s=k({control:c.control,name:"inventory"}),r=s.fields.length>1,{mutateAsync:d,isPending:u}=B(t==null?void 0:t.product_id),h=c.handleSubmit(async m=>{const y={},_={};t.inventory_items.forEach(i=>y[i.inventory.id]=i.required_quantity),m.inventory.forEach(i=>_[i.inventory_item_id]=!0);const a={};m.inventory.forEach(i=>{i.inventory_item_id in y?i.required_quantity!==y[i.inventory_item_id]&&(a.update=a.update||[],a.update.push({required_quantity:f(i.required_quantity),inventory_item_id:i.inventory_item_id,variant_id:t.id})):(a.create=a.create||[],a.create.push({required_quantity:f(i.required_quantity),inventory_item_id:i.inventory_item_id,variant_id:t.id}))}),t.inventory_items.forEach(i=>{i.inventory.id in _||(a.delete=a.delete||[],a.delete.push({inventory_item_id:i.inventory.id,variant_id:t.id}))}),await d(a,{onSuccess:()=>{q.success(n("products.variant.inventory.toast.itemsManageSuccess")),l()},onError:i=>{q.error(i.message)}})});return e.jsx(p.Form,{form:c,children:e.jsxs(F,{className:"flex h-full flex-col overflow-hidden",onSubmit:h,children:[e.jsx(p.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(p.Close,{asChild:!0,children:e.jsx(x,{size:"small",variant:"secondary",children:n("actions.cancel")})}),e.jsx(x,{size:"small",type:"submit",isLoading:u,children:n("actions.save")})]})}),e.jsx(p.Body,{className:"flex justify-center",children:e.jsxs("div",{className:"flex w-full flex-col gap-y-8 px-6 pt-12 md:w-[720px] md:pt-24",children:[e.jsx(L,{children:n(r?"products.create.inventory.heading":"fields.inventoryItems")}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o.Label,{children:t.title}),e.jsx(o.Hint,{children:n(r?"products.create.inventory.label":"fields.inventoryItem")})]}),e.jsx(x,{size:"small",variant:"secondary",type:"button",onClick:()=>{s.append({inventory_item_id:"",required_quantity:""})},children:n("actions.add")})]}),s.fields.map((m,y)=>e.jsx(G,{form:c,inventoryIndex:y,inventoryItem:m,onRemove:()=>s.remove(y)},m.id))]})]})})]})})}function re(){const{id:t,variant_id:n}=R(),{variant:l,isPending:c,isError:s,error:r}=T(t,n,{fields:N});if(s)throw r;return e.jsx(p,{children:!c&&l&&e.jsx(O,{variant:l})})}export{re as Component};
